const Ot=new Intl.Collator("en").compare,St=1/0,wt=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),Ct="eexxaacctt",Xt="A-Z",Gt="a-z",nt=(t,l,s)=>t.replace(Xt,l).replace(Gt,s),zt={unicode:!1,alpha:null,interSplit:"[^A-Za-z\\d']+",intraSplit:"[a-z][A-Z]",intraBound:"[A-Za-z]\\d|\\d[A-Za-z]|[a-z][A-Z]",interLft:0,interRgt:0,interChars:".",interIns:St,intraChars:"[a-z\\d']",intraIns:0,intraContr:"'[a-z]{1,2}\\b",intraMode:0,intraSlice:[1,St],intraSub:0,intraTrn:0,intraDel:0,intraFilt:(t,l,s)=>!0,sort:(t,l,s)=>{let{idx:n,chars:r,terms:f,interLft2:p,interLft1:A,start:N,intraIns:et,interIns:E}=t;return n.map((C,j)=>j).sort((C,j)=>r[j]-r[C]||et[C]-et[j]||f[j]+p[j]+.5*A[j]-(f[C]+p[C]+.5*A[C])||E[C]-E[j]||N[C]-N[j]||Ot(l[n[C]],l[n[j]]))}},It=(t,l)=>l==0?"":l==1?t+"??":l==St?t+"*?":t+`{0,${l}}?`,jt="(?:\\b|_)";function Y(t){t=Object.assign({},zt,t);let{unicode:l,interLft:s,interRgt:n,intraMode:r,intraSlice:f,intraIns:p,intraSub:A,intraTrn:N,intraDel:et,intraContr:E,intraSplit:C,interSplit:j,intraBound:st,intraChars:v}=t,ut=t.letters??t.alpha;if(ut!=null){let e=ut.toLocaleUpperCase(),a=ut.toLocaleLowerCase();j=nt(j,e,a),C=nt(C,e,a),st=nt(st,e,a),v=nt(v,e,a),E=nt(E,e,a)}let q=l?"u":"";const Lt='".+?"',yt=new RegExp(Lt,"gi"+q),Mt=new RegExp(`(?:\\s+|^)-(?:${v}+|${Lt})`,"gi"+q);let{intraRules:ct}=t;ct==null&&(ct=e=>{let a=zt.intraSlice,m=0,h=0,c=0,o=0,w=e.length;return w<=4?w>=3&&(c=Math.min(N,1),w==4&&(m=Math.min(p,1))):(a=f,m=p,h=A,c=N,o=et),{intraSlice:a,intraIns:m,intraSub:h,intraTrn:c,intraDel:o}});let $t=!!C,Bt=new RegExp(C,"g"+q),Dt=new RegExp(j,"g"+q),Zt=new RegExp("^"+j+"|"+j+"$","g"+q),Pt=new RegExp(E,"gi"+q);const ft=e=>{let a=[];e=e.replace(yt,h=>(a.push(h),Ct)),e=e.replace(Zt,"").toLocaleLowerCase(),$t&&(e=e.replace(Bt,h=>h[0]+" "+h[1]));let m=0;return e.split(Dt).filter(h=>h!="").map(h=>h===Ct?a[m++]:h)},ht=(e,a=0,m=!1)=>{let h=ft(e);if(h.length==0)return[];let c=Array(h.length).fill("");h=h.map((x,g)=>x.replace(Pt,P=>(c[g]=P,"")));let o;if(r==1)o=h.map((x,g)=>{let{intraSlice:P,intraIns:I,intraSub:u,intraTrn:i,intraDel:z}=ct(x);if(I+u+i+z==0)return x+c[g];if(x[0]==='"')return wt(x.slice(1,-1));let[S,d]=P,R=x.slice(0,S),$=x.slice(d),y=x.slice(S,d);I==1&&R.length==1&&R!=y[0]&&(R+="(?!"+R+")");let W=y.length,H=[x];if(u)for(let L=0;L<W;L++)H.push(R+y.slice(0,L)+v+y.slice(L+1)+$);if(i)for(let L=0;L<W-1;L++)y[L]!=y[L+1]&&H.push(R+y.slice(0,L)+y[L+1]+y[L]+y.slice(L+2)+$);if(z)for(let L=0;L<W;L++)H.push(R+y.slice(0,L+1)+"?"+y.slice(L+1)+$);if(I){let L=It(v,1);for(let k=0;k<W;k++)H.push(R+y.slice(0,k)+L+y.slice(k)+$)}return"(?:"+H.join("|")+")"+c[g]});else{let x=It(v,p);a==2&&p>0&&(x=")("+x+")("),o=h.map((g,P)=>g[0]==='"'?wt(g.slice(1,-1)):g.split("").map((I,u,i)=>(p==1&&u==0&&i.length>1&&I!=i[u+1]&&(I+="(?!"+I+")"),I)).join(x)+c[P])}let w=s==2?jt:"",Z=n==2?jt:"",O=Z+It(t.interChars,t.interIns)+w;return a>0?m?o=w+"("+o.join(")"+Z+"|"+w+"(")+")"+Z:(o="("+o.join(")("+O+")(")+")",o="(.??"+w+")"+o+"("+Z+".*)"):(o=o.join(O),o=w+o+Z),[new RegExp(o,"i"+q),h,c]},at=(e,a,m)=>{let[h]=ht(a);if(h==null)return null;let c=[];if(m!=null)for(let o=0;o<m.length;o++){let w=m[o];h.test(e[w])&&c.push(w)}else for(let o=0;o<e.length;o++)h.test(e[o])&&c.push(o);return c};let Et=!!st,gt=new RegExp(j,q),pt=new RegExp(st,q);const dt=(e,a,m)=>{let[h,c,o]=ht(m,1),[w]=ht(m,2),Z=c.length,O=e.length,x=Array(O).fill(0),g={idx:Array(O),start:x.slice(),chars:x.slice(),terms:x.slice(),interIns:x.slice(),intraIns:x.slice(),interLft2:x.slice(),interRgt2:x.slice(),interLft1:x.slice(),interRgt1:x.slice(),ranges:Array(O)},P=s==1||n==1,I=0;for(let u=0;u<e.length;u++){let i=a[e[u]],z=i.match(h),S=z.index+z[1].length,d=S,R=!1,$=0,y=0,W=0,H=0,Rt=0,L=0,k=0,At=0,J=[];for(let T=0,b=2;T<Z;T++,b+=2){let Q=z[b].toLocaleLowerCase(),U=c[T],X=U[0]=='"'?U.slice(1,-1):U+o[T],B=X.length,D=Q.length,M=Q==X;if(!M&&z[b+1].length>=B){let _=z[b+1].toLocaleLowerCase().indexOf(X);_>-1&&(J.push(d,D,_,B),d+=xt(z,b,_,B),Q=X,D=B,M=!0,T==0&&(S=d))}if(P||M){let _=d-1,G=d+D,K=!1,lt=!1;if(_==-1||gt.test(i[_]))M&&$++,K=!0;else{if(s==2){R=!0;break}if(Et&&pt.test(i[_]+i[_+1]))M&&y++,K=!0;else if(s==1){let ot=z[b+1],F=d+D;if(ot.length>=B){let V=0,tt=!1,Nt=new RegExp(X,"ig"+q),Tt;for(;Tt=Nt.exec(ot);){V=Tt.index;let _t=F+V,mt=_t-1;if(mt==-1||gt.test(i[mt])){$++,tt=!0;break}else if(pt.test(i[mt]+i[_t])){y++,tt=!0;break}}tt&&(K=!0,J.push(d,D,V,B),d+=xt(z,b,V,B),Q=X,D=B,M=!0,T==0&&(S=d))}if(!K){R=!0;break}}}if(G==i.length||gt.test(i[G]))M&&W++,lt=!0;else{if(n==2){R=!0;break}if(Et&&pt.test(i[G-1]+i[G]))M&&H++,lt=!0;else if(n==1){R=!0;break}}M&&(Rt+=B,K&&lt&&L++)}if(D>B&&(At+=D-B),T>0&&(k+=z[b-1].length),!t.intraFilt(X,Q,d)){R=!0;break}T<Z-1&&(d+=D+z[b+1].length)}if(!R){g.idx[I]=e[u],g.interLft2[I]=$,g.interLft1[I]=y,g.interRgt2[I]=W,g.interRgt1[I]=H,g.chars[I]=Rt,g.terms[I]=L,g.interIns[I]=k,g.intraIns[I]=At,g.start[I]=S;let T=i.match(w),b=T.index+T[1].length,Q=J.length,U=Q>0?0:1/0,X=Q-4;for(let _=2;_<T.length;){let G=T[_].length;if(U<=X&&J[U]==b){let K=J[U+1],lt=J[U+2],ot=J[U+3],F=_,V="";for(let tt=0;tt<K;F++)V+=T[F],tt+=T[F].length;T.splice(_,F-_,V),b+=xt(T,_,lt,ot),U+=4}else b+=G,_++}b=T.index+T[1].length;let B=g.ranges[I]=[],D=b,M=b;for(let _=2;_<T.length;_++){let G=T[_].length;b+=G,_%2==0?M=b:G>0&&(B.push(D,M),D=M=b)}M>D&&B.push(D,M),I++}}if(I<e.length)for(let u in g)g[u]=g[u].slice(0,I);return g},xt=(e,a,m,h)=>{let c=e[a]+e[a+1].slice(0,m);return e[a-1]+=c,e[a]=e[a+1].slice(m,m+h),e[a+1]=e[a+1].slice(m+h),c.length},qt=5,Ut=(e,a,m,h=1e3,c)=>{m=m?m===!0?qt:m:0;let o=null,w=null,Z=[];a=a.replace(Mt,u=>{let i=u.trim().slice(1);return i[0]==='"'&&(i=wt(i.slice(1,-1))),Z.push(i),""});let O=ft(a),x;if(Z.length>0){if(x=new RegExp(Z.join("|"),"i"+q),O.length==0){let u=[];for(let i=0;i<e.length;i++)x.test(e[i])||u.push(i);return[u,null,null]}}else if(O.length==0)return[null,null,null];if(m>0){let u=ft(a);if(u.length>1){let i=u.slice().sort((S,d)=>d.length-S.length);for(let S=0;S<i.length;S++){if((c==null?void 0:c.length)==0)return[[],null,null];c=at(e,i[S],c)}if(u.length>m)return[c,null,null];o=bt(u).map(S=>S.join(" ")),w=[];let z=new Set;for(let S=0;S<o.length;S++)if(z.size<c.length){let d=c.filter($=>!z.has($)),R=at(e,o[S],d);for(let $=0;$<R.length;$++)z.add(R[$]);w.push(R)}else w.push([])}}o==null&&(o=[a],w=[(c==null?void 0:c.length)>0?c:at(e,a)]);let g=null,P=null;if(Z.length>0&&(w=w.map(u=>u.filter(i=>!x.test(e[i])))),w.reduce((u,i)=>u+i.length,0)<=h){g={},P=[];for(let u=0;u<w.length;u++){let i=w[u];if(i==null||i.length==0)continue;let z=o[u],S=dt(i,e,z),d=t.sort(S,e,z);if(u>0)for(let R=0;R<d.length;R++)d[R]+=P.length;for(let R in S)g[R]=(g[R]??[]).concat(S[R]);P=P.concat(d)}}return[[].concat(...w),g,P]};return{search:(...e)=>Ut(...e),split:ft,filter:at,info:dt,sort:t.sort}}const Ht=(()=>{let t={A:"ÁÀÃÂÄĄ",a:"áàãâäą",E:"ÉÈÊËĖ",e:"éèêëę",I:"ÍÌÎÏĮ",i:"íìîïį",O:"ÓÒÔÕÖ",o:"óòôõö",U:"ÚÙÛÜŪŲ",u:"úùûüūų",C:"ÇČ",c:"çč",N:"Ñ",n:"ñ",S:"Š",s:"š"},l=new Map,s="";for(let f in t)t[f].split("").forEach(p=>{s+=p,l.set(p,f)});let n=new RegExp(`[${s}]`,"g"),r=f=>l.get(f);return f=>{if(typeof f=="string")return f.replace(n,r);let p=Array(f.length);for(let A=0;A<f.length;A++)p[A]=f[A].replace(n,r);return p}})();function bt(t){t=t.slice();let l=t.length,s=[t.slice()],n=new Array(l).fill(0),r=1,f,p;for(;r<l;)n[r]<r?(f=r%2&&n[r],p=t[r],t[r]=t[f],t[f]=p,++n[r],r=1,s.push(t.slice())):(n[r]=0,++r);return s}const Qt=(t,l)=>l?`<mark>${t}</mark>`:t,Wt=(t,l)=>t+l;function kt(t,l,s=Qt,n="",r=Wt){n=r(n,s(t.substring(0,l[0]),!1))??n;for(let f=0;f<l.length;f+=2){let p=l[f],A=l[f+1];n=r(n,s(t.substring(p,A),!0))??n,f<l.length-3&&(n=r(n,s(t.substring(l[f+1],l[f+2]),!1))??n)}return n=r(n,s(t.substring(l[l.length-1]),!1))??n,n}Y.latinize=Ht;Y.permute=t=>bt([...Array(t.length).keys()]).sort((s,n)=>{for(let r=0;r<s.length;r++)if(s[r]!=n[r])return s[r]-n[r];return 0}).map(s=>s.map(n=>t[n]));Y.highlight=kt;let rt=!1;function Vt(t=!rt){rt=t}let it=new Y({intraMode:1});function Yt(){rt=!rt,rt?it=new Y({intraMode:0,interLft:1,interRgt:1}):it=new Y({intraMode:1,interLft:0,interRgt:0})}function Jt(t,l){let s;return(...n)=>{const r=this;return new Promise((f,p)=>{const A=()=>{s=null,f(t.apply(r,n))},N=!s;clearTimeout(s),s=setTimeout(A,l),N&&f(t.apply(r,n))})}}function Kt(t,l,s){const n=t.filter(r=>(l==null?void 0:l.length)<1?!0:l.map(f=>f.toLowerCase()).includes(r.category.toLowerCase()));if(s){const r=n.map(E=>[E.title,E.subtitle,E.tags.map(C=>"hashtag-"+C),E.content,E.description].join(" ")),f=it.filter(r,s),p=it.info(f,r,s),A=it.sort(p,r,s),N=(E,C)=>C?'<b style="color:var(--brand-accent)">'+E+"</b>":E;return A.map(E=>{const C=n[p.idx[A[E]]],j=Y.highlight(r[p.idx[A[E]]].replaceAll("<"," ").replaceAll("/>","  ").replaceAll(">"," "),p.ranges[A[E]],N).slice(Math.max(p.ranges[A[E]][0]-200,0),Math.min(p.ranges[A[E]][1]+200,r[p.idx[A[E]]].length)).split(" ").slice(1,-1).join(" ");return{...C,highlightedResults:j}})}else return n}function vt(t,l,s){return Jt(Kt,100)(t,l,s)}export{Yt as changeSearchMode,vt as fuzzySearch,rt as isSearchExact,Vt as setIsSearchExact};
